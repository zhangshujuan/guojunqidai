/**
 * @author 
 * @email 
 * @descrip guojunqidai
 * @version v1.0.0
 */
define(function(require,exports,module){$.cxSelect=function(t){for(var e,t,s={dom:{},api:{}},n=function(t){return!(!t||"function"!=typeof HTMLElement&&"object"!=typeof HTMLElement||!(t instanceof HTMLElement))||!(!t||!t.nodeType||1!==t.nodeType)},i=function(t){return!!(t&&t.length&&("function"==typeof jQuery||"object"==typeof jQuery)&&t instanceof jQuery)},r=function(t){return Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)},o=0,a=arguments.length;o<a;o++)i(arguments[o])?e=arguments[o]:n(arguments[o])?e=$(arguments[o]):"object"==typeof arguments[o]&&(t=arguments[o]);if(!(e.length<1))return s.init=function(){var s=this;if(s.dom.box=e,s.settings=$.extend({},$.cxSelect.defaults,t,{url:s.dom.box.data("url"),nodata:s.dom.box.data("nodata"),required:s.dom.box.data("required"),firstTitle:s.dom.box.data("firstTitle"),firstValue:s.dom.box.data("firstValue")}),s.settings.selects.length){s.selectArray=[],s.selectSum=s.settings.selects.length;for(var n=0;n<s.selectSum&&s.dom.box.find("select."+s.settings.selects[n]);n++)s.selectArray.push(s.dom.box.find("select."+s.settings.selects[n]));s.selectSum=s.selectArray.length,s.selectSum&&("string"==typeof s.settings.url?$.getJSON(s.settings.url,function(t){s.dataJson=t,s.buildContent()}):"object"==typeof s.settings.url&&(s.dataJson=s.settings.url,s.buildContent()))}},s.getIndex=function(t){return this.settings.required?t:t-1},s.getNewOptions=function(t,e){if(t){var s=this.settings.firstTitle,n=this.settings.firstValue,i=t.data("firstTitle"),r=t.data("firstValue"),o="";return"string"!=typeof i&&"number"!=typeof i&&"boolean"!=typeof i||(s=i.toString()),"string"!=typeof r&&"number"!=typeof r&&"boolean"!=typeof r||(n=r.toString()),this.settings.required||(o='<option value="'+n+'">'+s+"</option>"),$.each(e,function(t,e){o+="string"==typeof e.v||"number"==typeof e.v||"boolean"==typeof e.v?'<option value="'+e.v+'">'+e.n+"</option>":'<option value="'+e.n+'">'+e.n+"</option>"}),o}},s.buildContent=function(){var t=this;t.dom.box.on("change","select",function(){t.selectChange(this.className)});var e=t.getNewOptions(t.selectArray[0],t.dataJson);t.selectArray[0].html(e).prop("disabled",!1).trigger("change"),t.setDefaultValue()},s.setDefaultValue=function(t){t=t||0;var e,s=this;t>=s.selectSum||!s.selectArray[t]||(e=s.selectArray[t].data("value"),"string"!=typeof e&&"number"!=typeof e&&"boolean"!=typeof e||(e=e.toString(),setTimeout(function(){s.selectArray[t].val(e).trigger("change"),t++,s.setDefaultValue(t)},1)))},s.selectChange=function(t){t=t.replace(/ /g,","),t=","+t+",";for(var e,s,n,i,o=[],a=0;a<this.selectSum;a++)o.push(this.getIndex(this.selectArray[a].get(0).selectedIndex)),"number"==typeof e&&a>e&&(this.selectArray[a].empty().prop("disabled",!0),"none"===this.settings.nodata?this.selectArray[a].css("display","none"):"hidden"===this.settings.nodata&&this.selectArray[a].css("visibility","hidden")),t.indexOf(","+this.settings.selects[a]+",")>-1&&(e=a);s=e+1,n=this.dataJson,this.settings.nextData&&this.settings.nextData(n,o,this.dom.box);for(var a=0;a<s;a++){if("undefined"==typeof n[o[a]]||r(n[o[a]].s)===!1||!n[o[a]].s.length)return;n=n[o[a]].s}this.selectArray[s]&&(i=this.getNewOptions(this.selectArray[s],n),this.selectArray[s].html(i).prop("disabled",!1).css({display:"",visibility:""}).trigger("change"))},s.init(),this},$.cxSelect.defaults={selects:[],url:null,nodata:null,required:!1,firstTitle:"请选择",firstValue:"0"},$.fn.cxSelect=function(t,e){return this.each(function(s){$.cxSelect(this,t,e)}),this}});